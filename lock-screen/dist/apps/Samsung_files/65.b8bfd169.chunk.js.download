(this["webpackJsonp@sprinklr/chat-web-client"]=this["webpackJsonp@sprinklr/chat-web-client"]||[]).push([[65],{1287:function(e,t,n){"use strict";var r=n(12),a=n(10),i=n(6),o=Object(a.a)("type"),c=Object(a.a)("url"),s=function e(){var t=this;Object(r.a)(this,e),this.setUrl=function(e){return t.data.url=e,t},this.setType=function(e){return t.data.type=e,t},this.build=function(){return t.data},this.data={}};s.getUrl=Object(i.a)(c),s.getType=Object(i.a)(o),t.a=s},1314:function(e,t,n){"use strict";t.a={GET:"get",POST:"post",PUT:"put",REMOVE:"remove"}},1400:function(e,t,n){"use strict";n.d(t,"a",(function(){return p}));var r=n(33),a=n(2),i=n(9),o=n.n(i),c=n(304),s=n(13),u="PREVIEW_LOADING",l="PREVIEW_LOADED",b="PREVIEW_LOAD_FAILED";function d(e,t){switch(t.type){case u:return Object(s.a)(Object(s.a)({},e),{},{loading:!0});case l:return{PreviewComponent:t.payload.PreviewComponent,error:void 0,loading:!1};case b:return{error:t.payload.error,loading:!1}}}function p(e,t){var n=Object(a.useRef)(),i=Object(a.useReducer)(d,{loading:!1}),s=Object(r.a)(i,2),p=s[0],f=s[1];return Object(a.useEffect)((function(){f({type:u});var r=function(e,t){return e?Object(c.b)(e,t):Promise.reject()}(e,t);n.current=r,r.then((function(e){e.defaultProps={previewType:"ENTITY_CHANNEL"},f({type:l,payload:{PreviewComponent:e}})})).catch((function(e){f({type:b,payload:{error:o()(e,"message","Failed to load Template")}})})).finally((function(){n.current=void 0}))}),[]),p}},1882:function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return On}));var r=n(2),a=n.n(r),i=n(231),o=n.n(i),c=n(33),s=n(3),u=n(4),l=n(9),b=n.n(l),d=n(232),p=n.n(d),f=n(17);var v=Object(f.a)("iframe",{target:"e4t9wyo0"})({name:"1l2nfdo",styles:"border:0 none;height:100%;width:100%;"}),h=Object(f.a)("div",{target:"e4t9wyo1"})("position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);width:",(function(e){return e.isPhone?"calc(100% - 64px)":"560px"}),";height:65%;overflow:hidden;",(function(e){var t=e.popupStyles;return t&&{borderColor:t.borderColor||"#1C6CFD",border:"".concat(t.stroke.borderWidth,"px ").concat(t.stroke.borderStyle)}}),";",(function(e){return e.popupStyles&&e.popupStyles.borderRadius}),";"),m="DESKTOP",O="MOBILE",j=new Set(Object.values({SURVEY_COMPLETE:"SURVEY_COMPLETE",SURVEY_CANCEL:"SURVEY_CANCEL"})),y=function(e){var t=e.deviceType,n=e.onClose,a=e.surveyUrl,i=e.popupStyles,o=Object(r.useContext)(d.FrameContext).window,c=Object(r.useCallback)((function(e,t){!t.error&&j.has(e)&&n()}),[]);return Object(r.useEffect)((function(){var e=function(e){if(e.origin.match(/(sprinklr\.com)/g))try{var t=JSON.parse(e.data),n=t.action,r=t.payload;c(n,r)}catch(a){console.error(a)}};return o.addEventListener("message",e),function(){o.removeEventListener("message",e)}}),[o]),Object(s.jsx)(h,{popupStyles:i,isPhone:t===O},Object(s.jsx)(v,{name:"spr-popup-survey",src:a}))},g=n(50),T="#000",w="#212529",E=700,C='-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", "Noto Color Emoji"',I='SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace',k="1rem",x=400,_=1.5,S="#007bff",A="underline",P="1rem",R="0.75rem",M="#6c757d",L=function(){var e=C,t=I,n=k,r=x,a=_,i=w,o=P,c=E,s=S,u=A,l=R,b=M;return"\n    *,\n    *::before,\n    *::after {\n      box-sizing: border-box;\n    }\n    html,\n    body {\n      height: 100%;\n    }\n    html {\n      font-family: sans-serif;\n      line-height: 1.15;\n      -webkit-text-size-adjust: 100%;\n      -ms-text-size-adjust: 100%;\n      -ms-overflow-style: scrollbar;\n      -webkit-tap-highlight-color: rgba(".concat(T,", 0);\n      letter-spacing: -0.12px;\n      text-rendering: optimizeLegibility;\n      -webkit-font-smoothing: antialiased;\n      -moz-osx-font-smoothing: grayscale;\n    }\n    @-ms-viewport {\n      width: device-width;\n    }\n    article,\n    aside,\n    figcaption,\n    figure,\n    footer,\n    header,\n    hgroup,\n    main,\n    nav,\n    section {\n      display: block;\n    }\n    body {\n      margin: 0;\n      font-family: ").concat(e,";\n      font-size: ").concat(n,";\n      font-weight: ").concat(r,";\n      line-height: ").concat(a,";\n      color: ").concat(i,";\n      text-align: left;\n    }\n    body *:focus {\n      outline: none;\n    }\n    [tabindex='-1']:focus {\n      outline: 0 !important;\n    }\n    hr {\n      box-sizing: content-box;\n      height: 0;\n      overflow: visible;\n    }\n    h1,\n    h2,\n    h3,\n    h4,\n    h5,\n    h6 {\n      margin-top: 0;\n      margin-bottom: 0;\n    }\n    p {\n      margin-top: 0;\n      margin-bottom: ").concat(o,";\n    }\n    abbr[title],\n    abbr[data-original-title] {\n      text-decoration: underline;\n      text-decoration: underline dotted;\n      cursor: help;\n      border-bottom: 0;\n    }\n    address {\n      margin-bottom: 1rem;\n      font-style: normal;\n      line-height: inherit;\n    }\n    ol,\n    ul,\n    dl {\n      margin-top: 0;\n      margin-bottom: 1rem;\n    }\n    ol ol,\n    ul ul,\n    ol ul,\n    ul ol {\n      margin-bottom: 0;\n    }\n    dt {\n      font-weight: ").concat(c,";\n    }\n    dd {\n      margin-bottom: 0.5rem;\n      margin-left: 0;\n    }\n    blockquote {\n      margin: 0 0 1rem;\n    }\n    dfn {\n      font-style: italic;\n    }\n    b,\n    strong {\n      font-weight: bolder;\n    }\n    small {\n      font-size: 80%;\n    }\n    sub,\n    sup {\n      position: relative;\n      font-size: 75%;\n      line-height: 0;\n      vertical-align: baseline;\n    }\n    sub {\n      bottom: -0.25em;\n    }\n    sup {\n      top: -0.5em;\n    }\n    a {\n      color: ").concat(s,";\n      text-decoration: ").concat(u,";\n      background-color: transparent;\n      -webkit-text-decoration-skip: objects;\n    }\n    a:not([href]):not([tabindex]) {\n      color: inherit;\n      text-decoration: none;\n      &:focus,\n      &:hover {\n        color: inherit;\n        text-decoration: none;\n      }\n      &:focus {\n        outline: 0;\n      }\n    }\n    pre,\n    code,\n    kbd,\n    samp {\n      font-family: ").concat(t,";\n      font-size: 1em;\n    }\n    pre {\n      margin-top: 0;\n      margin-bottom: 1rem;\n      overflow: auto;\n      -ms-overflow-style: scrollbar;\n    }\n    figure {\n      margin: 0 0 1rem;\n    }\n    img {\n      vertical-align: middle;\n      border-style: none;\n    }\n    svg {\n      overflow: hidden;\n      vertical-align: middle;\n    }\n    table {\n      border-collapse: collapse;\n    }\n    caption {\n      padding-top: ").concat(l,";\n      padding-bottom: ").concat(l,";\n      color: ").concat(b,";\n      text-align: left;\n      caption-side: bottom;\n    }\n    th {\n      text-align: inherit;\n    }\n    label {\n      display: inline-block;\n      margin-bottom: 0;\n    }\n    button {\n      border-radius: 0;\n    }\n    button:focus {\n      outline: 1px dotted;\n      outline: 5px auto -webkit-focus-ring-color;\n    }\n    input,\n    button,\n    select,\n    optgroup,\n    textarea {\n      margin: 0;\n      font-family: inherit;\n      font-size: inherit;\n      line-height: inherit;\n    }\n    button,\n    input {\n      overflow: visible;\n    }\n    button,\n    select {\n      text-transform: none;\n    }\n    button,\n    html [type='button'],\n    [type='reset'],\n    [type='submit'] {\n      -webkit-appearance: button;\n    }\n    button::-moz-focus-inner,\n    [type='button']::-moz-focus-inner,\n    [type='reset']::-moz-focus-inner,\n    [type='submit']::-moz-focus-inner {\n      padding: 0;\n      border-style: none;\n    }\n    input[type='radio'],\n    input[type='checkbox'] {\n      box-sizing: border-box;\n      padding: 0;\n    }\n    input[type='date'],\n    input[type='time'],\n    input[type='datetime-local'],\n    input[type='month'] {\n      -webkit-appearance: listbox;\n    }\n    textarea {\n      overflow: auto;\n      resize: vertical;\n    }\n    fieldset {\n      min-width: 0;\n      padding: 0;\n      margin: 0;\n      border: 0;\n    }\n    legend {\n      display: block;\n      width: 100%;\n      max-width: 100%;\n      padding: 0;\n      margin-bottom: 0.5rem;\n      font-size: 1.5rem;\n      line-height: inherit;\n      color: inherit;\n      white-space: normal;\n    }\n    progress {\n      vertical-align: baseline;\n    }\n    [type='number']::-webkit-inner-spin-button,\n    [type='number']::-webkit-outer-spin-button {\n      height: auto;\n    }\n    [type='search'] {\n      outline-offset: -2px;\n      -webkit-appearance: none;\n    }\n    [type='search']::-webkit-search-cancel-button,\n    [type='search']::-webkit-search-decoration {\n      -webkit-appearance: none;\n    }\n    ::-webkit-file-upload-button {\n      font: inherit;\n      -webkit-appearance: button;\n    }\n    output {\n      display: inline-block;\n    }\n    summary {\n      display: list-item;\n      cursor: pointer;\n    }\n    template {\n      display: none;\n    }\n    [hidden] {\n      display: none !important;\n    }\n  ")},U=a.a.memo((function(){var e=L();return Object(s.jsx)(s.Global,{styles:Object(s.css)(e,";")})}));var N={name:"2b9rdz",styles:".frame-content{width:100%;height:100%;}.frame-root{height:100%;width:100%;}"},D=n(200),V=n.n(D),z=n(305),Q=V()((function(e){return Object(z.a)({container:e.head})})),G=function(e){return Object(s.jsx)(p.a,Object(g.a)({allowFullScreen:!0,initialContent:'\n<!DOCTYPE html>\n<html>\n    <head>\n        <meta charset="utf-8" />\n        <meta name="viewport" content="width=device-width, viewport-fit=cover, initial-scale=1, shrink-to-fit=no" />\n    </head>\n    <body><div class="frame-root"></div></body>\n</html>\n'},e),Object(s.jsx)(d.FrameContextConsumer,null,(function(t){var n=t.document;return Object(s.jsx)(s.CacheProvider,{value:Q(n)},Object(s.jsx)(U,null),Object(s.jsx)(s.Global,{styles:N}),e.children)})))};var H=Object(f.a)("div",{target:"esx7wwu0"})({name:"ev1ol6",styles:"height:100%;width:100%;top:0;left:0;position:fixed;z-index:2147483002 !important;transform:translatez(100000px) !important;"}),F=Object(f.a)(G,{target:"esx7wwu1"})({name:"1l2nfdo",styles:"border:0 none;height:100%;width:100%;"}),Y=n(1400);var B=a.a.createContext({height:0,width:0});var W=function(){return Object(r.useContext)(B)};var q=function(){var e=W();return Object(r.useMemo)((function(){return function(e){return e.width>=596&&e.height>=596}(e)}),[e])},J=n(92),K=n.n(J),Z=n(682),X=n.n(Z),$=n(131),ee=n.n($),te=n(12),ne=n(10),re=n(6),ae=Object(ne.a)("type"),ie=Object(ne.a)("value"),oe=Object(ne.a)("additional"),ce=function e(){Object(te.a)(this,e)};ce.getType=Object(re.a)(ae),ce.getValue=Object(re.a)(ie),ce.getAdditional=Object(re.a)(oe);var se=a.a.createContext(void 0),ue=n(13),le=n(207),be=n(0),de=n.n(be),pe=n(19),fe="DATA_LOADING",ve="DATA_LOADED",he="DATA_LOAD_FAILED",me="DATA_FETCHING_MORE",Oe={loading:!1,error:void 0,data:void 0},je=function(e,t){switch(t.type){case fe:return Object(ue.a)(Object(ue.a)({},e),{},{loading:!0,data:void 0,error:void 0});case me:return Object(ue.a)(Object(ue.a)({},e),{},{loading:!0,error:void 0});case ve:return Object(ue.a)(Object(ue.a)({},e),{},{loading:!1,data:t.payload});case he:return Object(ue.a)(Object(ue.a)({},e),{},{loading:!1,error:t.payload});default:return e}},ye=function(){return Object(r.useReducer)(je,Oe)},ge=n(1287),Te=n(112),we=function(e){var t=e.query,n=e.skipQueryOnMount,a=e.payload,i=ye(),o=Object(c.a)(i,2),s=o[0],u=o[1],l=s.loading,b=s.data,d=s.error,p=Object(r.useRef)(l);p.current=l;var f=Object(r.useRef)(b);f.current=b;var v=ge.a.getType(t),h=ge.a.getUrl(t),m=Object(r.useCallback)(function(){var e=Object(pe.a)(de.a.mark((function e(t){var n;return de.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!p.current){e.next=2;break}return e.abrupt("return");case 2:return u({type:fe,payload:{}}),e.prev=3,e.next=6,Te.a[v](h,t);case 6:n=e.sent,u({type:ve,payload:n.data}),e.next=13;break;case 10:e.prev=10,e.t0=e.catch(3),u({type:he,payload:e.t0});case 13:case"end":return e.stop()}}),e,null,[[3,10]])})));return function(t){return e.apply(this,arguments)}}(),[v,h]);return Object(r.useEffect)((function(){n||m(a)}),[]),{loading:l,data:b,error:d,refetch:Object(r.useCallback)((function(e){m(e)}),[m]),fetchMore:Object(r.useCallback)(function(){var e=Object(pe.a)(de.a.mark((function e(t,n){var r;return de.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!p.current){e.next=2;break}return e.abrupt("return");case 2:return u({type:me,payload:{}}),e.prev=3,e.next=6,Te.a[v](h,t);case 6:r=e.sent,u({type:ve,payload:n(f.current,r.data)}),e.next=13;break;case 10:e.prev=10,e.t0=e.catch(3),u({type:he,payload:e.t0});case 13:case"end":return e.stop()}}),e,null,[[3,10]])})));return function(t,n){return e.apply(this,arguments)}}(),[])}},Ee=n(108),Ce=n(1314),Ie=["refetch"],ke=(new ge.a).setUrl("/livechat/prompt/browse/event").setType(Ce.a.POST).build(),xe=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{skipQueryOnMount:!1},t=e.skipQueryOnMount,n=e.payload,a=we({query:ke,skipQueryOnMount:t,payload:Object(ue.a)(Object(ue.a)({},n),{},{sourceType:"PROACTIVE_PROMPT"})}),i=a.refetch,o=Object(le.a)(a,Ie),c=Object(r.useCallback)((function(e){return i(Object(ue.a)(Object(ue.a)({},e),{},{sourceType:"PROACTIVE_PROMPT",page:Object(Ee.a)().pageUrl,userAgent:Object(Ee.a)().userAgent,timeZone:Object(Ee.a)().timeZone}))}),[n]);return Object(ue.a)(Object(ue.a)({},o),{},{refetch:c})},_e="PAGE_VISIT",Se="TAB_CHANGE",Ae="TAB_CLOSE",Pe="INTERCEPT_TRIGGERED",Re="INTERCEPT_CLOSED",Me="INTERCEPT_ENGAGED",Le=function(){var e=xe({skipQueryOnMount:!0}).refetch;return Object(r.useCallback)((function(t){var n=t.type,r=t.payload;switch(n){case Pe:return e({eventType:Pe,eventId:r.interceptId,details:{}});case Me:return e({eventType:Me,eventId:r.interceptId,details:{targetId:r.targetId}});default:return e({eventType:Re,eventId:r.interceptId,details:{}})}}),[])},Ue="CLOSE",Ne="ENGAGE",De="LIVE_CHAT_ROUTE_TO_BOT",Ve="LIVE_CHAT_EXECUTE_RULE",ze="LIVE_CHAT_WITH_AGENT",Qe="CLOSE",Ge="SURVEY",He="SURVEY_INLINE",Fe="REMOVE";var Ye=function(e){var t=e.targets,n=e.interceptId,a=Le(),i=Object(r.useContext)(se);return Object(r.useCallback)((function(e){var r=function(){a({type:Re,payload:{interceptId:n}}),i.setAction(n,Ue)};return new Promise((function(o,c){var s=e.type,u=e.buttonId;if(s===Ue)return r(),void o();if(s===Ne){if(u){var l=function(e,t){return t&&e?t[e]:void 0}(u,t),b=l&&ce.getType(l);if(!b)return void o();if(b===Qe)return r(),void o()}return function(e){a({type:Me,payload:{targetId:e,interceptId:n}}),i.setAction(n,Ne)}(u),void o()}o()}))}),[a,t,n])},Be=n(26),We="SURVEY",qe=function(e){var t=e.interceptId,n=e.targets,a=e.creative,i=e.onClose,o=Object(Be.b)(),s=Object(r.useMemo)((function(){return X()(a.brandMessageText)&&{message:a.brandMessageText}}),[a.brandMessageText]),u=Ye({interceptId:t,targets:n}),l=Object(r.useState)(),d=Object(c.a)(l,2),p=d[0],f=d[1];return[p,Object(r.useCallback)((function(e){var r,c,l=b()(e,"targetType"),d=b()(e,"buttonId");if(!l)if(d){if(!(r=K()(a.buttons,(function(e){return e.id===d}))))return void console.warn("Spr Prompt Action Error - Button with id ".concat(d," was not found in creative"));l=(c=n[d])&&c.type}else l=Fe;switch(l){case Ve:case De:case ze:return o&&o.sprChat?(o.sprChat("openNewConversation",{initialMessages:ee()([s,{isSentByUser:!0,message:r&&r.title}]),additional:{interceptId:t,interceptTargetId:d}}),u({type:Ne,buttonId:d}),void i()):(console.warn("Spr Prompt Action Error - SprChat is not present in the window"),void i());case Ge:var p=ce.getAdditional(c);return p?(window.open(p),u({type:Ne,buttonId:d}),void i()):(console.warn("Spr Prompt Action Error - Cannot find Survey details in target"),void i());case He:var v=ce.getAdditional(c);if(v){var h="".concat(v,"&showClose=true&showThankYouClose=true");return u({type:Ne,buttonId:d}),void f({previewType:We,payload:h})}return console.warn("Spr Prompt Action Error - Cannot find Survey details in target"),void i();case Qe:return f(void 0),u({type:Ue}),void i();case Fe:return f(void 0),void i();default:console.warn("Spr Prompt Action Error - Target type (".concat(l,") not found")),i()}}),[a.buttons,n,o,u])]},Je=Object(ne.a)("type"),Ke=function e(){Object(te.a)(this,e)};Ke.getType=Object(re.a)(Je);var Ze,Xe=a.a.memo((function(e){var t=e.onClose,n=e.creative,a=e.targets,i=e.interceptId,o=function(e){return Object(Y.a)(e,"PROACTIVE_PROMPT")}(Ke.getType(n)).PreviewComponent,u=b()(n,"additional.popup"),l=q()?m:O,d=qe({interceptId:i,targets:a,creative:n,onClose:t}),p=Object(c.a)(d,2),f=p[0],v=p[1],h=Object(r.useCallback)((function(e){var t=e.buttonId;v({buttonId:t})}),[v]),j=Object(r.useCallback)((function(){v({targetType:Qe})}),[v]),g=Object(r.useCallback)((function(){v()}),[v]),T=f&&f.previewType===We;return o?Object(s.jsx)(H,null,Object(s.jsx)(F,{name:"spr-popup__box-frame"},Object(s.jsx)(o,{content:n,deviceType:l,onAction:h,onClose:j,hidePopup:T}),T&&Object(s.jsx)(y,{deviceType:l,onClose:g,surveyUrl:f&&f.payload,popupStyles:u}))):null})),$e=n(38),et=n.n($e),tt="CLOSED",nt=function(e){var t=e.interceptId,n=e.creative,a=e.targets,i=e.onClose,o=Object(Be.b)(),c=function(e){var t=e.interceptId,n=e.targets,a=Ye({targets:n,interceptId:t});return Object(r.useCallback)((function(e){return e.type===tt?a({type:Ue}):a({type:Ne,buttonId:b()(e,"button.id")})}),[a])}({interceptId:t,targets:a});return Object(r.useEffect)((function(){var e=function(e){c(e).catch((function(e){console.error(e)})).finally(i)};return o.sprChat("onPromptAction",e),function(){o.sprChat("offPromptAction",e)}}),[]),Object(r.useEffect)((function(){o.sprChat("openNewPrompt",{id:t,messages:[{text:n.text}],buttons:et()(n.buttons,(function(e){return{id:e.id,label:e.title,value:b()(a,["".concat(e.id),"type"])===Qe?"CLOSE":"NEW_CONVERSATION"}})),additional:Object(ue.a)(Object(ue.a)({},b()(n,"additional")),{},{interceptId:t})})}),[t,n,a]),null},rt="POPUP",at="LIVECHAT",it=(Ze={},Object(u.a)(Ze,rt,Xe),Object(u.a)(Ze,at,nt),Ze),ot=function(e){var t=e.creative,n=Ke.getType(t),r=it[n];return r?Object(s.jsx)(r,e):null},ct=n(710),st=Object(ne.a)("id"),ut=Object(ne.a)("creativeId"),lt=Object(ne.a)("targets"),bt=Object(ct.a)(["creative","socialAsset","content"]),dt=function e(){Object(te.a)(this,e)};dt.getId=Object(re.a)(st),dt.getCreativeId=Object(re.a)(ut),dt.getTargets=Object(re.a)(lt),dt.getCreative=Object(re.a)(bt);var pt=a.a.memo((function(e){var t=e.intercept,n=e.onClose,a=dt.getId(t),i=dt.getTargets(t),o=dt.getCreative(t),c=Le();return Object(r.useEffect)((function(){t&&c({type:Pe,payload:{interceptId:dt.getId(t)}})}),[t]),Object(s.jsx)(ot,{key:a,interceptId:a,creative:o,targets:i,onClose:n})})),ft=n(650);var vt,ht=function(e){var t=Object(ft.a)(e.window);return Object(s.jsx)(B.Provider,{value:t},e.children)},mt=a.a.createContext(void 0),Ot=n(35),jt=n(62),yt=n.n(jt),gt=n(482),Tt=n.n(gt),wt=n(243),Et=n.n(wt),Ct="IDLE",It="TRACKING",kt=(new ge.a).setUrl("/livechat/prompt/candidatePrompts").setType(Ce.a.POST).build(),xt=function(e,t){return[].concat(Object(Ot.a)(e||[]),Object(Ot.a)(t||[]))},_t=function(e){var t=we({query:kt,skipQueryOnMount:!0}),n=t.data,a=t.refetch,i=t.fetchMore,o=e.trackingStatus===Ct,s=Object(r.useState)(!o),u=Object(c.a)(s,2),l=u[0],b=u[1],d=Object(r.useRef)(o);d.current=o;var p=Object(r.useCallback)((function(){if(d.current)return a(Object(ue.a)(Object(ue.a)({},Object(Ee.a)()),{},{appId:Object(Be.a)().appId}));b(!0)}),[a]),f=Object(r.useCallback)((function(e){if(d.current)return i(Object(ue.a)(Object(ue.a)({},Object(Ee.a)()),{},{appId:Object(Be.a)().appId,variables:e}),xt);b(!0)}),[]);return Object(r.useEffect)((function(){o&&l&&(p(),b(!1))}),[o,l]),Object(r.useEffect)((function(){p()}),[]),{intercepts:n,refetchIntercepts:p,fetchMoreIntercepts:f}},St=n(690),At=n(110),Pt=function(e){return"PROMPT_".concat(At.a.getId(e),"_").concat(Date.now(),"_").concat(Math.random().toString(16).substr(2,8))},Rt=function(){return vt},Mt=function(){Rt().disconnect().then((function(){console.log("MQTT Client | Disconnected")})).catch((function(e){console.error("MQTT Client | Disconnection Error",e)}))},Lt=n(81),Ut="ADD_INTERCEPT",Nt=function(e,t){var n=Object(r.useMemo)((function(){return{chatUser:Lt.a.getChatUser(t),userName:Lt.a.getChatSessionToken(t),inboxServerUrl:Lt.a.getProactiveInboxServerUrl(t),userInbox:Lt.a.getProactiveUserInbox(t)}}),[t.chatUser,t.chatSessionToken,t.proactivePromptInboxServerUrl,t.proactiveUserInbox]);Object(r.useEffect)((function(){!function(e){var t=e.chatUser,n=e.userName,r=e.inboxServerUrl,a=e.userInbox,i=Pt(t);vt=new St.a({userName:n,clientId:i,inboxServerUrl:r,userInbox:a})}(n);try{!function(){Rt().connect().catch((function(e){console.error("MQTT Client | Connection Error",e)}));var e=Rt();e.on("error",(function(){console.log("MQTT Client | Error")})),e.on("offline",(function(){console.log("MQTT Client | Offline")})),e.on("reconnect",(function(){console.log("MQTT Client | Reconnect")})),e.on("close",(function(){console.log("MQTT Client | Closed")}))}(),Rt().subscribe().catch((function(e){console.error("MQTT client | Subscribe Error",e)})),Rt().on("message",(function(t,n){try{var r=JSON.parse(n.toString());e(r)}catch(a){console.error(a)}}))}catch(t){console.error(t),Mt()}return function(){try{Rt().unsubscribe()}catch(e){console.error(e)}finally{Mt()}}}),[n,e])},Dt=function(e,t){var n=_t(e),a=n.intercepts,i=n.refetchIntercepts,o=n.fetchMoreIntercepts,c=Object(r.useCallback)((function(e){o(e.payload.variables)}),[o]),s=Object(r.useCallback)((function(e){switch(e.payload.type){case Ut:c(e)}}),[c]);return Nt(s,t),Object(r.useEffect)((function(){return window.addEventListener("popstate",i),function(){window.removeEventListener("popstate",i)}}),[]),a},Vt=n(25),zt=n.n(Vt),Qt=n(194),Gt=n.n(Qt),Ht=n(269),Ft=n(507),Yt=function e(){var t=this;Object(te.a)(this,e),this._clockInstance=void 0,this._activeTime=void 0,this._visibilityChangeHandler=function(){var e=document.visibilityState;"hidden"===e&&(t._clockInstance.stop(),t._activeTime+=t._clockInstance.getEndTime()-t._clockInstance.getStartTime()),"visible"===e&&t._clockInstance.start()},this.time=function(){return"hidden"===document.visibilityState?t._activeTime:t._activeTime+(t._clockInstance.getCurrentTime()-t._clockInstance.getStartTime())},this._clockInstance=new Ft.a,"visible"===document.visibilityState&&this._clockInstance.start(),this._activeTime=0,document.addEventListener("visibilitychange",this._visibilityChangeHandler)},Bt=function e(){var t=this;Object(te.a)(this,e),this._clockInstance=void 0,this._inactiveTime=void 0,this._visibilityChangeHandler=function(){var e=document.visibilityState;"hidden"===e&&t._clockInstance.start(),"visible"===e&&(t._clockInstance.stop(),t._inactiveTime+=t._clockInstance.getEndTime()-t._clockInstance.getStartTime())},this.time=function(){return"visible"===document.visibilityState?t._inactiveTime:t._inactiveTime+(t._clockInstance.getCurrentTime()-t._clockInstance.getStartTime())},this._clockInstance=new Ft.a,"hidden"===document.visibilityState&&this._clockInstance.start(),this._inactiveTime=0,document.addEventListener("visibilitychange",this._visibilityChangeHandler)},Wt=n(651),qt=function(e,t){var n=Object(r.useState)(),a=Object(c.a)(n,2),i=a[0],o=a[1],s=Object(r.useMemo)((function(){return{totalTimeSpentClock:new Wt.a,activeTimeSpentClock:new Yt,inactiveTimeSpentClock:new Bt,interceptActionDetails:t}}),[]);return Object(r.useEffect)((function(){var t=ee()(et()(e,(function(e){if(e.filter){var t=Ht.a.createFilterAction(e.filter);return t.matches(Gt()(o,e),s),t}o(e)})));return function(){zt()(t,(function(e){e.clear()}))}}),[e]),i},Jt=n(61),Kt=n.n(Jt),Zt=n(15),Xt=n.n(Zt),$t=function(e,t){return t?Kt()(dt.getTargets(e),(function(e,n,r){return Object(ue.a)(Object(ue.a)({},e),{},Object(u.a)({},r,Object(ue.a)(Object(ue.a)({},n),{},{additional:t[n.value]})))}),{}):dt.getTargets(e)},en="/livechat/prompt";function tn(e){return nn.apply(this,arguments)}function nn(){return(nn=Object(pe.a)(de.a.mark((function e(t){var n;return de.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Te.a.get("".concat(en,"/creative/").concat(t));case 2:return n=e.sent,e.abrupt("return",n.data);case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function rn(e){return an.apply(this,arguments)}function an(){return(an=Object(pe.a)(de.a.mark((function e(t){var n;return de.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Te.a.post("".concat(en,"/fetch/survey"),t);case 2:return n=e.sent,e.abrupt("return",n.data);case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var on=function(e){var t=Object(r.useState)(),n=Object(c.a)(t,2),a=n[0],i=n[1];return Object(r.useEffect)((function(){if(e){var t=function(e){var t=dt.getId(e),n=Kt()(dt.getTargets(e),(function(e,t){return t.type===Ge||t.type===He?Object(ue.a)(Object(ue.a)({},e),{},{surveyURLs:e.surveyURLs?[].concat(Object(Ot.a)(e.surveyURLs),[t.value]):[t.value]}):e}),{});return Xt()(n)?void 0:Object(ue.a)(Object(ue.a)({},n),{},{variantId:t})}(e);Promise.all([tn(dt.getCreativeId(e)),t?rn(t):Promise.resolve(void 0)]).then((function(t){var n=Object(c.a)(t,2),r=n[0],a=n[1];i(Object(ue.a)(Object(ue.a)({},e),{},{creative:r,targets:$t(e,a)}))})).catch((function(e){console.error(e)}))}}),[e]),a},cn="REMOVE_INTERCEPT";var sn=function(e,t,n){var a=Object(r.useState)([]),i=Object(c.a)(a,2),o=i[0],s=i[1],u=Dt(e,t),l=qt(u,n),b=on(l);Object(r.useEffect)((function(){b&&s((function(e){return Et()([].concat(Object(Ot.a)(e),[b]))}))}),[b]);var d=Object(r.useCallback)((function(e){e.type===cn&&s((function(e){return Tt()(e,1)}))}),[]);return[yt()(o),d]},un=n(717),ln=function(){var e=Object(r.useCallback)((function(){return{eventType:_e,eventId:n.current,details:{title:Object(Ee.c)(),oldUrl:n.current,newUrl:a.current}}}),[]),t=Object(un.useFirstMountState)(),n=Object(r.useRef)(""),a=Object(r.useRef)(Object(Ee.b)()),i=xe({payload:e(),skipQueryOnMount:!1}),o=i.loading,c=i.refetch;return Object(r.useEffect)((function(){var t=function(){n.current=a.current,a.current=Object(Ee.b)(),c(e())};return window.addEventListener("popstate",t),function(){window.removeEventListener("popstate",t)}}),[c]),{trackingStatus:t||o?It:Ct}},bn=function(){var e=xe({skipQueryOnMount:!0}).refetch;Object(r.useEffect)((function(){var t=function(){var t=document.visibilityState;e({eventType:Se,eventId:Object(Ee.b)(),details:{isActive:"visible"===t}})};return document.addEventListener("visibilitychange",t),function(){document.removeEventListener("visibilitychange",t)}}),[e])},dn=function(){var e=xe({skipQueryOnMount:!0}).refetch;Object(r.useEffect)((function(){var t=function(){e({eventType:Ae,eventId:Object(Ee.b)(),details:{}})};return window.addEventListener("beforeunload",t),function(){window.removeEventListener("beforeunload",t)}}),[e])},pn=function(){return bn(),dn(),ln()},fn=n(31),vn=function(){function e(){Object(te.a)(this,e),this._map=void 0,this._map={}}return Object(fn.a)(e,[{key:"addEntry",value:function(e){this._map[e]||(this._map[e]={subscribers:[]})}},{key:"setAction",value:function(e,t){var n=function(e){var t=e.indexOf("_");return-1!==t?e.substring(0,t):e}(e);this.addEntry(n),this._map[n].actionState=t,this._map[n].actionTime=Date.now(),this._map[n].subscribers.forEach((function(e){e(t)})),this._map[n].subscribers=[]}},{key:"setSubscriber",value:function(e,t){var n=this;return this.addEntry(e),this._map[e].subscribers.push(t),function(){n._map[e].subscribers=n._map[e].subscribers.filter((function(e){return e!==t}))}}},{key:"getActionTime",value:function(e){return this._map[e]&&this._map[e].actionTime}},{key:"getActionState",value:function(e){return this._map[e]&&this._map[e].actionState}}]),e}(),hn=function(){return Object(r.useRef)(new vn).current},mn=a.a.memo((function(e){var t=pn(),n=hn(),a=sn(t,e.handshakeDetails,n),i=Object(c.a)(a,2),o=i[0],u=i[1],l=Object(Be.b)(),b=Object(r.useCallback)((function(){u({type:cn})}),[u]);return o?Object(s.jsx)(s.CacheProvider,{value:Q(l.document)},Object(s.jsx)(ht,{window:l},Object(s.jsx)(mt.Provider,{value:e.handshakeDetails},Object(s.jsx)(se.Provider,{value:n},Object(s.jsx)(pt,{intercept:o,onClose:b}))))):null}));function On(e,t,n){var r=function(e){var t=e.createElement("div");return t.id="spr-live-prompt-app",t.style.width="0",t.style.height="0",e.body.appendChild(t),t}(Object(Be.b)().document);o.a.render(Object(s.jsx)(mn,{handshakeDetails:t}),r)}}}]);
//# sourceMappingURL=65.b8bfd169.chunk.js.map